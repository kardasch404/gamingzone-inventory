generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Stock {
  id           String    @id @default(uuid())
  sku          String    // References Product.sku in Catalog service
  warehouseId  String
  
  quantity     Int       @default(0) // Total available
  reserved     Int       @default(0) // Reserved for pending orders
  available    Int       @default(0) // Computed: quantity - reserved
  
  minThreshold Int       @default(5)  // Alert when stock below this
  maxCapacity  Int?      // Maximum stock capacity
  
  version      Int       @default(0) // Optimistic locking
  lastStockAt  DateTime?  // Last time stock was updated
  
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  
  @@unique([sku, warehouseId])
  @@index([sku])
  @@index([warehouseId])
  @@index([available])
  @@map("stocks")
}
